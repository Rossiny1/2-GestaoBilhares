# üö™ WINDSURF GATES - PROTOCOLO DE DIAGN√ìSTICO OBRIGAT√ìRIO

> Implementa√ß√£o do protocolo Gates (0-4) para WindSurf  
> M√°ximo 2 builds por problema | Diagn√≥stico baseado em evid√™ncia  
> Baseado em DEV_GUIDE.md e PROJECT_README.md

---

## üéØ OBJETIVO DOS GATES

Resolver problemas com **m√°xima efici√™ncia**:
- **Diagn√≥stico primeiro** (n√£o tentativa-erro)
- **M√°ximo 2 builds** por problema
- **Evid√™ncia obrigat√≥ria** (c√≥digo ou logs)
- **Zero loops infinitos**

---

## üö™ GATE 0 - DIAGN√ìSTICO PRIMEIRO

### Decision Tree Autom√°tica

```yaml
# WindSurf: Classificar problema automaticamente
gate_0_classification:
  trigger: Ao identificar problema
  
  questions:
    - "√â regress√£o? (funcionava antes)"
    - "Erro vis√≠vel no c√≥digo?"
    - "C√≥digo parece OK mas falha?"
    
  paths:
    regressao_or_visible_error:
      method: "static_analysis"
      max_builds: 1
      actions:
        - Ler PROJECT_README.md
        - Static Analysis com rg/grep
        - Identificar causa raiz
        
    codigo_ok_mas_falha:
      method: "dynamic_analysis" 
      max_builds: 2
      actions:
        - Adicionar logs estrat√©gicos
        - Build com logs
        - Capturar e analisar
```

### Regras Anti-Loop

```yaml
# WindSurf: Prevenir loops infinitos
anti_loop_rules:
  condition: "gradlew_build_count > 2"
  
  actions:
    - "PARAR IMEDIATAMENTE"
    - "VOLTAR PARA GATE 0"
    - "RELER DOCUMENTA√á√ÉO"
    - "PEDIR AJUDA HUMANA"
    
  message: |
    üö® LOOP DETECTADO!
    
    Voc√™ rodou Gradle mais de 2 vezes.
    Isso viola o protocolo Gates.
    
    A√ß√µes:
    1. PARE de rodar builds
    2. VOLTE e leia o c√≥digo calmamente
    3. Use Static Analysis primeiro
    4. Se ainda falhar, pe√ßa ajuda
    
    Motivo: Tentativa-erro gera loops e perda de tempo.
```

### Static Analysis Toolkit

```bash
# WindSurf: Comandos autom√°ticos de diagn√≥stico
static_analysis_commands:
  # Encontrar componentes
  component_search:
    - rg "SettlementViewModel" --type kt -n
    - rg "sync_operations" --type kt -C 5
    
  # Arqueologia (regress√£o)
  archaeology:
    - rg "usuarioId" --type kt -C 3
    - rg "groupBy" --type kt
    - git blame <arquivo> -L 450,470
    
  # Verificar padr√µes
  pattern_check:
    - rg "@HiltViewModel" --type kt
    - rg "StateFlow" --type kt
    - rg "rota_id" --type kt
```

---

## üö™ GATE 1 - PLANO CIR√öRGICO

### Template Autom√°tico

```yaml
# WindSurf: Gerar plano automaticamente
gate_1_plan_template:
  required_fields:
    - arquivo_alvo: "Arquivo exato a modificar"
    - linhas_especificas: "N√∫mero das linhas"
    - mudanca_exata: "O que ser√° mudado"
    - validacao_minima: "Como testar"
    
  example:
    problema: "Campo usuarioId est√° null"
    arquivo_alvo: "ui/src/main/java/.../SettlementViewModel.kt"
    linhas_especificas: "455-460"
    mudanca_exata: "Adicionar usuarioId = userSession.currentUser.id"
    validacao_minima: "Build passa + testes unit√°rios"
```

### Valida√ß√£o Autom√°tica do Plano

```yaml
# WindSurf: Verificar se plano √© v√°lido
plan_validation:
  checks:
    - "Arquivo existe?"
    - "Linhas s√£o razo√°veis (< 50 linhas)?"
    - "Mudan√ßa √© espec√≠fica (n√£o gen√©rica)?"
    - "Valida√ß√£o √© mensur√°vel?"
    
  failures:
    - "Plano muito vago ‚Üí Refinar"
    - "Mudan√ßa muito grande ‚Üí Dividir"
    - "Valida√ß√£o imposs√≠vel ‚Üí Redefinir"
```

---

## üö™ GATE 2 - ESCOPO DELIMITADO

### Matriz de Impacto

```yaml
# WindSurf: Calcular impacto automaticamente
gate_2_scope_matrix:
  files_to_change:
    - "Listar arquivos que SER√ÉO modificados"
    - "Justificar cada modifica√ß√£o"
    
  files_not_to_touch:
    - "Listar arquivos que N√ÉO ser√£o tocados"
    - "Explicar por que s√£o seguros"
    
  dependencies:
    - "M√≥dulos impactados"
    - "Testes afetados"
    - "Configura√ß√µes alteradas"
    
  example:
    files_to_change:
      - "SettlementViewModel.kt (adicionar usuarioId)"
      - "SettlementViewModelTest.kt (atualizar teste)"
      
    files_not_to_touch:
      - "AppRepository.kt (FACADE - n√£o refatorar)"
      - "SyncRepository.kt (complexo - fora do escopo)"
```

### An√°lise de Riscos

```yaml
# WindSurf: Avaliar riscos automaticamente
risk_analysis:
  high_risk:
    - "Modificar AppRepository"
    - "Alterar estrutura Firestore"
    - "Mudar regras de neg√≥cio"
    
  medium_risk:
    - "Modificar ViewModels cr√≠ticos"
    - "Alterar DAOs"
    - "Mudar sync handlers"
    
  low_risk:
    - "UI/UX improvements"
    - "Logs e debugging"
    - "Refatora√ß√£o pequena"
```

---

## üö™ GATE 3 - EXECU√á√ÉO INCREMENTAL

### Estrat√©gia de Mudan√ßas

```yaml
# WindSurf: Executar mudan√ßas incrementalmente
gate_3_incremental_execution:
  strategy:
    - "Uma mudan√ßa por vez"
    - "Build ap√≥s cada mudan√ßa"
    - "Teste ap√≥s cada build"
    - "Rollback se piorar"
    
  sequence:
    1. "Implementar mudan√ßa 1"
    2. "Build: .\gradlew.bat :app:assembleDebug"
    3. "Teste: .\gradlew.bat testDebugUnitTest"
    4. "Se OK ‚Üí pr√≥xima mudan√ßa"
    5. "Se falhar ‚Üí rollback e analisar"
```

### Valida√ß√£o Autom√°tica

```yaml
# WindSurf: Verificar cada passo
validation_steps:
  build_validation:
    - "Compila sem erros?"
    - "Warnings aceit√°veis?"
    
  test_validation:
    - "Testes passam?"
    - "Sem regress√µes?"
    
  architecture_validation:
    - "MVVM mantido?"
    - "Multi-tenancy respeitado?"
    - "Offline-first funcionando?"
```

---

## üö™ GATE 4 - PARADA OBRIGAT√ìRIA

### Condi√ß√µes de Parada

```yaml
# WindSurf: Condi√ß√µes autom√°ticas de parada
gate_4_stop_conditions:
  immediate_stop:
    - "build_count >= 2 AND falhando"
    - "tentativas >= 3 sem solu√ß√£o"
    - "regress√£o detectada"
    - "loop identificado"
    
  actions:
    - "PARAR imediatamente"
    - "DOCUMENTAR tentativas"
    - "ANALISAR padr√£o do erro"
    - "PEDIR ajuda humana"
    
  message_template: |
    üö® GATE 4 - PARADA OBRIGAT√ìRIA
    
    Condi√ß√µes atingidas:
    - Builds: {build_count}/2 (m√°ximo)
    - Tentativas: {attempts}/3 (m√°ximo)
    - Status: {status}
    
    Pr√≥ximos passos:
    1. PARE de tentar
    2. Documente o que tentou
    3. Pe√ßa ajuda humana
    4. Aprenda com o erro
    
    Motivo: Protocolo Gates existe para evitar loops.
```

### Recupera√ß√£o Autom√°tica

```yaml
# WindSurf: Sugest√µes autom√°ticas de recupera√ß√£o
recovery_suggestions:
  when_build_fails:
    - "Verificar imports (Hilt, Room)"
    - "Checar sintaxe Kotlin"
    - "Validar multi-tenancy (rota_id)"
    
  when_tests_fail:
    - "Verificar mocks"
    - "Checar assertions"
    - "Validar setup de teste"
    
  when_regression:
    - "Git blame no c√≥digo alterado"
    - "Comparar com vers√£o funcional"
    - "Identificar mudan√ßa que quebrou"
```

---

## üîß IMPLEMENTA√á√ÉO WINDSURF

### Triggers Autom√°ticos

```yaml
# WindSurf: Configurar triggers dos Gates
windsurf_triggers:
  on_problem_detected:
    - "Iniciar Gate 0 automaticamente"
    - "Classificar tipo de problema"
    - "Sugerir m√©todo (static/dynamic)"
    
  on_build_start:
    - "Verificar Gate 1 completo"
    - "Validar Gate 2 definido"
    - "Contar builds (m√°x 2)"
    
  on_build_failure:
    - "Incrementar contador"
    - "Verificar Gate 4 conditions"
    - "Sugerir recupera√ß√£o"
    
  on_success:
    - "Resetar contadores"
    - "Documentar solu√ß√£o"
    - "Atualizar conhecimento"
```

### Comandos WindSurf

```bash
# WindSurf: Comandos r√°pidos dos Gates
/wind gate0          # Iniciar diagn√≥stico
/wind gate1          # Criar plano cir√∫rgico
/wind gate2          # Definir escopo
/wind gate3          # Executar incremental
/wind gate4          # Verificar parada
/wind status         # Ver status atual
/wind reset          # Resetar contadores
```

### Snippets Autom√°ticos

```kotlin
// WindSurf: Snippet para diagn√≥stico
/wind snippet diagnostic

private const val TAG = "[DIAGNOSTICO]"

Log.d(TAG, "üìç 1. Origem: ${origem}")
Log.d(TAG, "üîÑ 2. Processando: ${dados}")
Log.d(TAG, "üéØ 3. Resultado: ${resultado}")
```

```kotlin
// WindSurf: Snippet para valida√ß√£o
/wind snippet validation

// Valida√ß√µes obrigat√≥rias
requireNotNull(data.empresa_id) { "empresa_id obrigat√≥rio" }
requireNotNull(data.rota_id) { "rota_id obrigat√≥rio" }
require(userSessionManager.canAccessRota(data.rota_id)) { "Acesso negado" }
```

---

## üìä M√âTRICAS E MONITORAMENTO

### KPIs dos Gates

```yaml
# WindSurf: M√©tricas autom√°ticas
gate_metrics:
  success_rate:
    - "Problemas resolvidos / tentativas"
    - "Meta: > 80%"
    
  time_to_resolution:
    - "Tempo m√©dio por problema"
    - "Meta: < 30 minutos"
    
  build_efficiency:
    - "Builds por problema"
    - "Meta: < 2 builds"
    
  loop_prevention:
    - "Loops evitados"
    - "Meta: 100%"
```

### Dashboard Autom√°tico

```yaml
# WindSurf: Dashboard em tempo real
dashboard:
  current_status:
    gate: "Gate {current_gate}/4"
    builds: "{build_count}/2"
    attempts: "{attempt_count}/3"
    
  recent_problems:
    - timestamp: "2026-01-28 10:15"
      problem: "Campo null em SettlementViewModel"
      gate_used: "Gate 0 (Static Analysis)"
      resolution_time: "12 minutos"
      builds_used: "1"
```

---

## üéØ BENEF√çCIOS ESPERADOS

### Para IAs
- **Diagn√≥stico r√°pido:** 10 minutos vs 2 horas
- **Zero loops:** M√°ximo 2 builds garantidos
- **Alta autonomia:** Trabalham sem interven√ß√£o
- **Aprendizado:** Padroniza√ß√£o de solu√ß√µes

### Para Humanos
- **Produtividade:** Problemas resolvidos r√°pido
- **Qualidade:** C√≥digo segue padr√µes
- **Confian√ßa:** Sem regress√µes
- **Previsibilidade:** Tempo de resolu√ß√£o conhecido

### Para Projeto
- **Sa√∫de:** D√≠vida t√©cnica controlada
- **Performance:** Builds otimizados
- **Manutenibilidade:** C√≥digo documentado
- **Evolu√ß√£o:** Base s√≥lida para crescimento

---

## üöÄ EXEMPLO COMPLETO

### Problema: Campo usuarioId null

```yaml
# WindSurf: Exemplo completo do protocolo
problem_example:
  gate_0:
    classification: "regressao"
    method: "static_analysis"
    evidence: "git blame mostra linha removida"
    
  gate_1:
    arquivo_alvo: "SettlementViewModel.kt"
    linhas: "455-460"
    mudanca: "Adicionar usuarioId = userSession.currentUser.id"
    validacao: "Build passa + testes unit√°rios"
    
  gate_2:
    files_to_change: ["SettlementViewModel.kt"]
    files_not_to_touch: ["AppRepository.kt"]
    dependencies: ["UserSessionManager"]
    
  gate_3:
    passo1: "Adicionar usuarioId na linha 457"
    build1: "‚úÖ Sucesso"
    test1: "‚úÖ Passando"
    
  resultado:
    time_to_resolution: "15 minutos"
    builds_used: "1"
    status: "Resolvido"
```

---

*Protocolo Gates implementado e otimizado para WindSurf.*
