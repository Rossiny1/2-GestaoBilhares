---
description: 
globs: 
alwaysApply: true
---
# CONTEXTO DO PROJETO 

Dever√° usar o tema: "Added Deep Space" em todas as telas do projeto.
Usar como referencia do tema o projeto do site: https://fenado.ai/preview/app/mesaacerto-7XdqeU

## Vis√£o Geral do Projeto
- Nome do aplicativo: GestaoBilhares (Mesa Acerto)
- Finalidade: Gest√£o de mesas de sinuca, controle de acertos e gera√ß√£o de recibos para locadores.
- P√∫blico: Desenvolvedor iniciante em Android/Kotlin.
- Funcionamento: Offline-first com sincroniza√ß√£o na nuvem (Firebase Firestore).

- Arquitetura: MVVM (Model-View-ViewModel) com Room Database para persist√™ncia local.
- Linguagem: Kotlin.
- UI: Material Design Components, Navigation Component.

## Estrutura do Aplicativo (16 Telas Principais + Extras)
1. ‚úÖ Onboarding/Login - Tela de boas-vindas com campos de login para colaboradores
2. ‚úÖ Tela Rotas - Inicial - Exibi√ß√£o de todas as rotas dispon√≠veis
2.1. ‚úÖ Gerenciar Rotas - Cadastrar, editar e excluir rotas (Admin apenas)
3. ‚úÖ Lista de Clientes da Rota - Exibe clientes da rota com indicadores visuais
4. ‚ùå **FALTA: Tela do Cliente** - Mostra hist√≥rico de acerto do cliente + bot√£o "Novo Acerto"
5. ‚ùå **FALTA: Acerto** - Registro de acerto com campos para m√∫ltiplas mesas
6. ‚ùå **FALTA: Hist√≥rico Acerto Detalhado** - Exibe dados detalhados de um acerto
7. ‚ùå **FALTA: Recibo** - Tela para impress√£o e envio via WhatsApp
8. ‚ùå **FALTA: Relat√≥rios** - Gera√ß√£o e an√°lise de relat√≥rios
9. ‚ùå **FALTA: Hist√≥rico Relat√≥rios Gerados** - Exibe relat√≥rios finalizados
10. ‚ùå **FALTA: Relat√≥rio Detalhado** - Detalhes completos de um relat√≥rio espec√≠fico
11. ‚ùå **FALTA: Cadastros** - Tela principal de cadastros
12. ‚ùå **FALTA: Cadastro Cliente** - Formul√°rio para cadastro de clientes
13. ‚ùå **FALTA: Cadastro Colaboradores** - Formul√°rio para cadastro de colaboradores
14. ‚ùå **FALTA: Cadastro Despesa** - Formul√°rio para cadastro de despesas
15. ‚ùå **FALTA: Cadastro Mesa** - Formul√°rio para cadastro de mesas
16. ‚ùå **FALTA: Tela Mesas** - Gerenciamento de todas as mesas da empresa
Extra: ‚úÖ Hist√≥rico de Despesas - Implementada funcionalmente

## Entidades Principais
- Rotas: Agrupamento l√≥gico de clientes.
- Clientes: Estabelecimentos com mesas alugadas.
- Mesas: Mesas de sinuca com contadores (fichas inicial/final).
- Acertos: Registros financeiros peri√≥dicos por cliente, detalhando mesas.
- Colaboradores: Usu√°rios do app (Admin/User).
- Despesas: Registros de despesas operacionais.
- Relat√≥rios: Registros de an√°lises financeiras e operacionais.

## Regras de Neg√≥cio Essenciais
1. C√°lculos de Acerto:
   - Fichas Jogadas = Fichas Final - Fichas Inicial (por mesa)
   - Subtotal Mesa = Fichas Jogadas * Valor Ficha Cliente
   - Total Mesas = Soma Subtotais das Mesas no Acerto
   - Valor Total = Total Mesas + D√©bito Anterior Cliente
   - Valor c/ Desconto = Valor Total - Desconto Aplicado
   - D√©bito Atual = Valor c/ Desconto - Valor Recebido
2. Transfer√™ncia de Mesas: Ficha Final do √∫ltimo acerto vira Ficha Inicial no novo cliente.
3. N√≠veis de Acesso: Admin (total), User (limitado - n√£o cadastra rotas, mesas, colaboradores).
4. Sincroniza√ß√£o: Prioridade local em conflitos. Sincronizar quando online.
5. Relat√≥rios: Finalizados n√£o podem ser editados. C√°lculos de totais, m√©dias, % pagantes.
6. Recibos: Impressora t√©rmica 58mm (Bluetooth), op√ß√£o de envio WhatsApp, QR Code.
7. Valida√ß√µes: Alerta quando Fichas Final < Fichas Inicial, solicitando justificativa.

## Padr√µes de C√≥digo e Boas Pr√°ticas
- Usar ViewModel, LiveData/Flow, Repository Pattern, Room, Coroutines.
- Usar ViewBinding.
- Seguir princ√≠pios SOLID (especialmente SRP).
- Tratamento de erros consistente (try-catch, Result class).
- Testes unit√°rios para l√≥gica cr√≠tica.
- C√≥digo limpo, leg√≠vel e bem comentado.
- Evitar l√≥gica na UI (Activities/Fragments).

## Preven√ß√£o de Erros Comuns
- Checar nulos (safe calls `?.`, elvis operator `?:`).
- N√£o bloquear thread principal.
- Liberar recursos (observadores, coroutines) no ciclo de vida correto.
- Validar entrada do usu√°rio.
- Testar em diferentes cen√°rios e dispositivos.

## Instru√ß√µes Gerais para o Cursor AI
1. **Foco no Iniciante:** Explique conceitos complexos de forma simples. Forne√ßa c√≥digo comentado extensivamente.
2. **Linguagem:** Use Kotlin exclusivamente.
3. **Arquitetura:** Siga estritamente MVVM.
4. **Boas Pr√°ticas:** Aplique as melhores pr√°ticas Android modernas.
5. **Consist√™ncia:** Mantenha o estilo e padr√µes do c√≥digo j√° existente.
6. **Seguran√ßa:** N√£o gere c√≥digo com vulnerabilidades √≥bvias.
7. **Testes:** Sugira ou gere testes unit√°rios para l√≥gica complexa.
8. **Clareza:** Priorize c√≥digo leg√≠vel e manuten√≠vel.
9. **Respeitar Fases:** N√£o introduza conceitos de fases futuras prematuramente.
10. **N√£o Modificar Estrutura:** Preserve a estrutura de pacotes e arquivos definida.

## Status Atual (ATUALIZADO - Dezembro 2024)
- **Fase Atual:** 4A - Cr√≠tica (Detalhes do Cliente + In√≠cio de Acertos)
- **Componentes Conclu√≠dos:** 
  - ‚úÖ Login e Autentica√ß√£o (Firebase)
  - ‚úÖ Estrutura MVVM com Hilt
  - ‚úÖ Tela Rotas + Navega√ß√£o
  - ‚úÖ Gerenciamento de Rotas (Admin)
  - ‚úÖ Lista de Clientes por Rota
  - ‚úÖ Hist√≥rico de Despesas
  - ‚úÖ Theme "Added Deep Space"
- **Pr√≥ximos Passos CR√çTICOS:** 
  - ‚ùå **ClientDetailFragment** (bloqueando fluxo principal)
  - ‚ùå **SettlementFragment** b√°sico (core business)
  - ‚ùå Navega√ß√£o completa Cliente ‚Üí Detalhes ‚Üí Acerto
- **Lacunas Identificadas:**
  - üö® **CR√çTICA:** Sem fluxo de acertos (core business)
  - üö® **ALTA:** Sem cadastros b√°sicos (depend√™ncia de mocks)
  - üö® **M√âDIA:** Sem relat√≥rios e gest√£o de mesas

## üéØ **PR√ìXIMA A√á√ÉO OBRIGAT√ìRIA**
**IMPLEMENTAR FASE 4A IMEDIATAMENTE** - Desbloquear√° todo o fluxo do aplicativo

Sempre usar o JDK  jbr21 jetBrains conforme caminho C:/Program Files/Android/Android Studio1/jbr  e  
SDK Android 15.0 API level 35 conforme caminho C:\Users\Rossiny\AppData\Local\Android\Sdk



